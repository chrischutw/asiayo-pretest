# Q2

## Question
試想有一個 API 伺服器集群，背後由多台機器組成，此時服務監控系統發現其中一台回應時間經常逾時，僅有此機器異常，請簡易描述你/妳將會如何進行問題排查？考量的細節是什麼？


## Answer

### 假設

1. 是 VM 而非實體機
2. 應用程式是 container based
3. 集群中的機器配置及設定以及網路環境皆相同

### 排查步驟

1. 初步調查與排除常見故障
- 確認警報是否為真，直接發送 request 到該伺服器，觀察是否有逾時的狀況
- 若確實有逾時的狀況發生，則判斷是否要將伺服器先從叢集群中移除，以維持服務的可靠性

2. 檢查伺服器資源使用情況
- 使用 top, htop, vmstat 或 iostat 等工具檢查 CPU、記憶體和磁碟的使用狀況，跟其他伺服器比起來，是否有異常的資源消耗
- 檢查是否有大量的連線處於 TIME_WAIT 或者 SYN_RECV 狀態而將連線佔滿導致回應逾時

3. 檢查應用程式運行狀況
- 檢查這台伺服器的應用程式 log 是否有異常
- 檢查應用程式是否有被正確部屬，與其他集群機器的版本是否相同

### 若伺服器在地端而非雲上

1. 伺服器基礎設施檢查
- 運行該 VM 的伺服器是否健康，硬體狀況是否良好，以及其他 VM 是否有相同的問題

因現實中的狀況太多，一一假設會寫不完，總之大致上的邏輯就將可能性一一排除，直到找出問題為止